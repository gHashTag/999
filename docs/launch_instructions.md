# Инструкции по запуску сервисов через PM2

Для обеспечения стабильной работы всех необходимых сервисов в проекте AgentKit, мы используем PM2 для управления процессами. Ниже приведены шаги и команды для запуска, перезапуска и мониторинга сервисов.

## Установка PM2

Если PM2 еще не установлен, выполните следующую команду для глобальной установки:

```bash
npm install -g pm2
```

## Конфигурационный файл

Конфигурационный файл для PM2 находится в корне проекта и называется `ecosystem.config.json`. Он содержит настройки для запуска трех основных сервисов:

- `build-watch` - для непрерывной сборки проекта.
- `dev-serve` - для обслуживания API или фронтенда.
- `dev-start` - для запуска дополнительных сервисов разработки.

Содержимое файла `ecosystem.config.json`:

```json
{
  "apps": [
    {
      "name": "build-watch",
      "script": "bun",
      "args": "run build:watch",
      "autorestart": true,
      "watch": false,
      "env": {
        "NODE_ENV": "development"
      }
    },
    {
      "name": "dev-serve",
      "script": "bun",
      "args": "run dev:serve",
      "autorestart": true,
      "watch": false,
      "env": {
        "NODE_ENV": "development"
      }
    },
    {
      "name": "dev-start",
      "script": "bun",
      "args": "run dev:start",
      "autorestart": true,
      "watch": false,
      "env": {
        "NODE_ENV": "development"
      }
    }
  ]
}
```

## Запуск сервисов

Для запуска всех сервисов, указанных в конфигурационном файле, выполните:

```bash
pm2 start ecosystem.config.json
```

## Проверка статуса сервисов

Чтобы проверить статус всех запущенных сервисов, используйте:

```bash
pm2 status
```

## Перезапуск сервисов

Если некоторые сервисы не запустились корректно (например, из-за конфликта портов), можно перезапустить их с помощью:

```bash
pm2 restart dev-serve dev-start
```

## Освобождение портов

Если порты 8288 или 8484 заняты другими процессами, найдите и завершите эти процессы с помощью:

```bash
lsof -i :8288; lsof -i :8484
```

Затем завершите процессы, используя их PID:

```bash
kill -9 <PID>
```

После этого перезапустите сервисы с помощью команды `pm2 restart`.

## Сохранение конфигурации

После успешного запуска всех сервисов сохраните текущую конфигурацию PM2, чтобы она сохранялась при перезапуске системы:

```bash
pm2 save
```

## Дополнительные команды PM2

- Для просмотра логов конкретного сервиса:
  ```bash
  pm2 logs <service-name>
  ```
- Для остановки всех сервисов:
  ```bash
  pm2 stop all
  ```
- Для удаления всех сервисов из PM2:
  ```bash
  pm2 delete all
  ```

Эти инструкции помогут поддерживать стабильную работу всех сервисов в проекте AgentKit.
